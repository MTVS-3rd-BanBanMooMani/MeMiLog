<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Me Mission Log</title>
    <link th:href="@{/document/css/home.css}" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css">
    <link rel="stylesheet" href="../../document/css/layout.css" />
    <link href="../../static/document/css/home.css" rel="stylesheet" />
    <style>
        .photo-div {
            transition: opacity 0.5s ease-in-out;
        }
        .photo-div.hidden {
            opacity: 0;
        }
        .photo-div.visible {
            opacity: 1;
        }
    </style>
</head>
<body>
<div class="container">
    <div th:replace="~{/fragments/mainHeader :: header}"></div>
    <!-- ì´ ë°‘ìœ¼ë¡œ ì‘ì„± -->
    <div class="middle-container">
        <div class="search-bar-container">
            <form action="/mission" method="get">
                <input type="text" name="word">
                <button type="submit">
                    <img th:src="@{/document/img/material-symbols-light.png}">
                </button>
            </form>
        </div>
        <div class="mission-container">
            <img class="mission-img" th:src="@{/document/img/banner.jpg}" />
            <div th:text="'6ì›” 20ì¼ì˜ ë¯¸ì…˜'"></div>
            <div th:text="${missionTitle}"></div>
            <button onclick="location.href='/post/create'">ë‚˜ë„ ë‚¨ê¸°ëŸ¬ ê°€ê¸°</button>
        </div>
        <div class="today-container">
            <div class="today-label">
                <p th:text="${todayPostCount} + ' ëª…ì˜ ë¯¸ë¯¸ë“¤ì˜ ì˜¤ëŠ˜ğŸ“·'"></p>
            </div>
            <div class="today-photo-container" id="today-photo-container">
                <img th:src="@{/document/img/home-left-arrow.png}" onclick="scrollTodayPhotos(-1)">
                <div th:each="post : ${todayPostDTOList}" class="photo-div hidden">
                    <img th:src="${post.picture}">
                    <p th:text="${post.nickname}"></p>
                </div>
                <img th:src="@{/document/img/home-right-arrow.png}" onclick="scrollTodayPhotos(1)">
            </div>
        </div>
        <div class="random-container">
            <div class="random-label">
                <p>ë¯¸ë¯¸ë¡œê·¸ ì•„ì¹´ì´ë¸ŒğŸ°</p>
            </div>
            <div class="random-photo-container" id="archive-photo-container">
                <img th:src="@{/document/img/home-left-arrow.png}" onclick="showRandomPosts()">
                <div th:each="archive : ${archivePostDTOList}" class="photo-div" type="post">
                    <img th:src="${archive.picture}">
                    <p th:text="${archive.nickname}"></p>
                </div>
                <img th:src="@{/document/img/home-right-arrow.png}" onclick="showRandomPosts()">
            </div>
        </div>
    </div>

    <div th:replace="~{/fragments/mainFooter :: footer}"></div>
</div>
<script>
    var successMessage = `[[${successMessage}]]`;
    if (successMessage) alert(successMessage);

    var todayPhotoIndex = 0;
    const photosPerPage = 8;
    const totalTodayPhotos = [[${todayPostCount}]];

    console.log(totalTodayPhotos);
    function scrollTodayPhotos(step) {
        var container = document.getElementById('today-photo-container');
        if (!container) {
            console.error('today-photo-container not found');
            return;
        }
        var photos = container.getElementsByClassName('photo-div');

        // ë‹¤ìŒ ì¸ë±ìŠ¤ë¥¼ ê³„ì‚°
        todayPhotoIndex += step * photosPerPage;

        // ì¸ë±ìŠ¤ê°€ ìŒìˆ˜ê°€ ë˜ì§€ ì•Šë„ë¡ ì¡°ì •
        if (todayPhotoIndex < 0) {
            todayPhotoIndex = 0;
        }

        // ì¸ë±ìŠ¤ê°€ ì´ í¬ìŠ¤íŠ¸ ìˆ˜ë¥¼ ë„˜ì§€ ì•Šë„ë¡ ì¡°ì •
        if (todayPhotoIndex >= totalTodayPhotos) {
            todayPhotoIndex = Math.max(0, totalTodayPhotos - photosPerPage);
        }

        // ì‹¤ì œ í‘œì‹œ ê°€ëŠ¥í•œ ì‚¬ì§„ ìˆ˜ ê³„ì‚°
        var maxIndex = Math.min(todayPhotoIndex + photosPerPage, totalTodayPhotos);

        // ë‚¨ì€ í¬ìŠ¤íŠ¸ ìˆ˜ë¥¼ ê³„ì‚°
        var remainingPosts = totalTodayPhotos - todayPhotoIndex;

        // ëª¨ë“  í¬í† ë¥¼ ìˆ¨ê¹€ ì²˜ë¦¬
        for (var i = 0; i < photos.length; i++) {
            photos[i].classList.remove('visible');
            photos[i].classList.add('hidden');
        }

        setTimeout(() => {
            // í˜„ì¬ ì¸ë±ìŠ¤ì— ë”°ë¼ í¬í†  ë³´ì—¬ì£¼ê¸°
            for (var i = todayPhotoIndex; i < maxIndex; i++) {
                if (i < photos.length) {
                    photos[i].classList.remove('hidden');
                    photos[i].classList.add('visible');
                }
            }

            // ë‚¨ì€ í¬ìŠ¤íŠ¸ê°€ 8ê°œ ë¯¸ë§Œì¼ ê²½ìš° ë¹ˆ ê³µê°„ ì²˜ë¦¬
            if (remainingPosts < photosPerPage) {
                for (var i = maxIndex; i < todayPhotoIndex + photosPerPage; i++) {
                    if (i < photos.length) {
                        // ë¹ˆ ê³µê°„ì„ ìœ„í•´ ìˆ¨ê¹€ ì²˜ë¦¬
                        photos[i].classList.add('hidden');
                    }
                }
            }

            console.log(`Visible Photos: ${Array.from(photos).filter(photo => !photo.classList.contains('hidden')).map(photo => photo.innerHTML)}`);
        }, 500); // ì• ë‹ˆë©”ì´ì…˜ ì‹œê°„ê³¼ ì¼ì¹˜í•˜ë„ë¡ ì„¤ì •
    }
    // ì´ˆê¸°í™”í•  ë•Œ ì²« 8ì¥ í‘œì‹œ
    document.addEventListener("DOMContentLoaded", () => {
        scrollTodayPhotos(0);
    });


    function showRandomPosts() {
        var container = document.getElementById('archive-photo-container');
        if (!container) {
            console.error('archive-photo-container not found');
            return;
        }
        var allPhotos = container.getElementsByClassName('photo-div');
        var postPhotos = Array.from(allPhotos).filter(photo => photo.getAttribute('type') === 'post');

        // ëª¨ë“  í¬í† ë¥¼ ìˆ¨ê¹€ ì²˜ë¦¬
        for (var i = 0; i < allPhotos.length; i++) {
            allPhotos[i].classList.remove('visible');
            allPhotos[i].classList.add('hidden');
        }

        // ë¬´ì‘ìœ„ë¡œ ì‚¬ì§„ ì„ íƒ
        var randomPhotos = [];
        while (randomPhotos.length < photosPerPage && postPhotos.length > 0) {
            var randomIndex = Math.floor(Math.random() * postPhotos.length);
            randomPhotos.push(postPhotos.splice(randomIndex, 1)[0]);
        }

        setTimeout(() => {
            // ë¬´ì‘ìœ„ë¡œ ì„ íƒëœ í¬í† ë¥¼ ë³´ì—¬ì£¼ê¸°
            randomPhotos.forEach(photo => {
                photo.classList.remove('hidden');
                photo.classList.add('visible');
            });

            console.log(`Random Photos: ${randomPhotos.map(photo => photo.innerHTML)}`);
        }, 500); // ì• ë‹ˆë©”ì´ì…˜ ì‹œê°„ê³¼ ì¼ì¹˜í•˜ë„ë¡ ì„¤ì •
    }
</script>
</body>
</html>
