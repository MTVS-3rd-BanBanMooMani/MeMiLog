<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.banbanmoomani.memilog.DAO.MydiaryMapper">
    <resultMap id="postResultMap" type="com.banbanmoomani.memilog.DTO.PostDTO">
        <id property="postId" column="post_id"/>
        <result property="title" column="title"/>
        <result property="content" column="content"/>
        <result property="likeCount" column="like_count"/>
        <result property="missionId" column="mission_id"/>
        <result property="writtenDatetime" column="written_datetime"/>
        <result property="nickname" column="nickname"/>
        <result property="missionContent" column="mission_content"/>
        <result property="missionDate" column="missionDate"/>
        <result property="priThemeName" column="priThemeName"/>
        <result property="subThemeName" column="subThemeName"/>
        <result property="emotionName" column="emotionName"/>
        <result property="companionType" column="companionType"/>
        <result property="srcUrl" column="srcUrl"/>
    </resultMap>

    <select id="findAllPosts" resultMap="postResultMap">
        SELECT
              p.post_id
            , p.title
            , p.content
            , p.like_count
            , p.mission_id
            , p.written_datetime
            , u.nickname
            , m.mission_content AS missionContent
            , DATE_FORMAT(m.mission_date, '%m월 %d일') AS missionDate
            , mt.theme_name AS priThemeName
            , st.theme_name AS subThemeName
            , e.emotion_name AS emotionName
            , c.companion_type AS companionType
            , a.src_url AS srcUrl
        FROM
            POST p
                LEFT JOIN MISSION m ON p.mission_id = m.mission_id
                LEFT JOIN THEME mt ON m.pri_theme_id = mt.theme_id
                LEFT JOIN THEME st ON m.sub_theme_id = st.theme_id
                LEFT JOIN EMOTION e ON p.emotion_id = e.emotion_id
                LEFT JOIN COMPANION c ON p.companion_id = c.companion_id
                LEFT JOIN USER u ON p.user_id = u.user_id
                LEFT JOIN ATTACHMENT a ON p.post_id = a.post_id
        WHERE
            u.user_id = 1
          AND a.type = 'post';
    </select>

    <select id="findUserById" resultType="com.banbanmoomani.memilog.DTO.user.UserDTO">
        SELECT
                u.user_id
              , u.email
              , u.password
              , u.birthday
              , u.nickname
              , u.gender
              , u.signup_date
              , a.src_url as srcUrl
        FROM USER u
             LEFT JOIN
             ATTACHMENT a ON u.user_id = a.user_id
        WHERE u.user_id = 1
        AND a.type = 'profile';
    </select>


</mapper>