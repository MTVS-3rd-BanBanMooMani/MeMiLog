<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.banbanmoomani.memilog.DAO.AttachmentMapper">
    <resultMap id="attachmentResultMap" type="com.banbanmoomani.memilog.DTO.AttachmentDTO">
        <id property="user_id" column="user_id"/>
        <result property="picture_id" column="picture_id"/>
        <result property="src_url" column="src_url"/>
        <result property="type" column="type"/>
        <result property="post_id" column="post_id"/>
        <result property="picture_order" column="picture_order"/>
        <result property="notice_id" column="notice_id"/>
    </resultMap>

    <insert id="insertAttachment" parameterType="com.banbanmoomani.memilog.DTO.AttachmentDTO"
            useGeneratedKeys="true" keyProperty="pictureId">
        INSERT INTO ATTACHMENT
        (
            src_url,
            type,
            post_id,
            user_id,
            picture_order,
            notice_id
        )
        VALUES
        (
            #{srcUrl},
            #{type},
            #{postId},
            #{userId},
            #{pictureOrder},
            #{noticeId}
        )
    </insert>

    <update id="updateProfilePic" parameterType="com.banbanmoomani.memilog.DTO.AttachmentDTO">
        UPDATE USER
        <trim prefix="SET" suffixOverrides=",">
            <if test="user_id != null and user_id !=''">
                user_id = #{user_id},
            </if>
            <if test="picture_id != null and picture_id !=''">
                picture_id = #{picture_id},
            </if>
            <if test="src_url != null and src_url !=''">
                src_url = #{src_url},
            </if>
            <if test="type != null and type !=''">
                type = #{type},
            </if>
            <if test="post_id != null and post_id !=''">
                post_id = #{post_id},
            </if>
            <if test="picture_order != null and picture_order !=''">
                picture_order = #{picture_order},
            </if>
            <if test="notice_id != null and notice_id !=''">
                notice_id = #{notice_id},
            </if>
        </trim>
        WHERE user_id = #{user_id}
        AND type = #{type}
    </update>
</mapper>