<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.banbanmoomani.memilog.DAO.MydiaryMapper">
    <resultMap id="integratedResultMap" type="com.banbanmoomani.memilog.DTO.IntegratedDTO">
        <id property="userId" column="user_id"/>
        <!-- User related fields -->
        <result property="email" column="email"/>
        <result property="password" column="password"/>
        <result property="birthday" column="birthday"/>
        <result property="nickName" column="nickname"/>
        <result property="gender" column="gender"/>
        <result property="cautionWeights" column="caution_weights"/>
        <result property="temporaryYN" column="temporary_YN"/>
        <result property="todayAccessYN" column="today_access_YN"/>
        <result property="signupDate" column="signup_date"/>
        <result property="suspPeriod" column="susp_period"/>

        <!-- Theme related fields -->
        <result property="themeId" column="theme_id"/>
        <result property="themeName" column="theme_name"/>

        <!-- Mission related fields -->
        <result property="missionId" column="mission_id"/>
        <result property="missionContent" column="mission_content"/>
        <result property="missionDate" column="mission_date"/>
        <result property="priThemeId" column="pri_theme_id"/>
        <result property="subThemeId" column="sub_theme_id"/>

        <!-- Picture related fields -->
        <result property="pictureId" column="picture_id"/>
        <result property="srcUrl" column="src_url"/>
        <result property="type" column="type"/>
        <result property="pictureOrder" column="picture_order"/>

        <!-- Post related fields -->
        <result property="postId" column="post_id"/>
        <result property="title" column="title"/>
        <result property="content" column="content"/>
        <result property="likeCount" column="like_count"/>
        <result property="writtenDatetime" column="written_datetime"/>
        <result property="together" column="together"/>
        <result property="companionId" column="companion_id"/>

        <!-- Companion related fields -->
        <result property="companionType" column="companion_type"/>

        <!-- Emotion related fields -->
        <result property="emotionId" column="emotion_id"/>
        <result property="emotionName" column="emotion_name"/>
    </resultMap>


    <select id="findAllContents" resultMap="integratedResultMap">
        SELECT
            u.user_id,
            u.email,
            u.password,
            u.birthday,
            u.nickname,
            u.signup_date,
            t.theme_id,
            t.theme_name,
            m.mission_id,
            m.mission_content,
            m.mission_date,
            m.pri_theme_id,
            m.sub_theme_id,
            a.picture_id,
            a.src_url,
            a.type,
            a.picture_order,
            p.post_id,
            p.title,
            p.content,
            p.like_count,
            p.written_datetime,
            p.together,
            p.companion_id,
            c.companion_type,
            e.emotion_id,
            e.emotion_name
        FROM
            USER u
                LEFT JOIN
            POST p ON u.user_id = p.user_id
                LEFT JOIN
            MISSION m ON p.mission_id = m.mission_id
                LEFT JOIN
            ATTATCHMENT a ON p.post_id = a.post_id
                LEFT JOIN
            COMPANION c ON p.companion_id = c.companion_id
                LEFT JOIN
            EMOTION e ON p.emotion_id = e.emotion_id
                LEFT JOIN
            THEME t ON (m.pri_theme_id = t.theme_id OR m.sub_theme_id = t.theme_id)
        WHERE u.user_id = 1;
    </select>

</mapper>